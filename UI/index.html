<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>TODO | Productivity Intelligence</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>

<style>
body{
    background:#020617;
    color:white;
    font-family:'Inter',sans-serif;
}

.glass{
    background:rgba(30,41,59,0.7);
    backdrop-filter:blur(12px);
    border:1px solid rgba(255,255,255,0.1);
}

.custom-scrollbar::-webkit-scrollbar{
    width:6px;
}

.custom-scrollbar::-webkit-scrollbar-thumb{
    background:#334155;
    border-radius:10px;
}
</style>
</head>

<body class="p-6 lg:p-12 min-h-screen">

<div class="max-w-6xl mx-auto space-y-10">

<!-- HEADER -->
<div class="flex justify-between items-center">
<h1 class="text-3xl font-bold uppercase">
TODO<span class="text-blue-500">APPLICATION</span>
</h1>

<div class="px-4 py-1 rounded-full
bg-blue-500/10 border border-blue-500/20
text-blue-400 text-[10px] font-bold">
Backend Connected
</div>
</div>


<!-- ANALYTICS + AI -->
<div class="grid grid-cols-1 md:grid-cols-2 gap-8">

<!-- ANALYTICS -->
<div class="glass p-8 rounded-3xl shadow-2xl">
<h2 class="text-2xl font-bold mb-6 flex gap-2 text-emerald-400">
<i data-lucide="bar-chart-3"></i>
Analytics
</h2>

<div class="space-y-4 text-xl">
<p class="flex justify-between border-b border-white/5 pb-2">
Created:
<span id="total-created">0</span>
</p>

<p class="flex justify-between">
Success Rate:
<span id="completion-rate"
class="text-emerald-400 font-bold">0%</span>
</p>
</div>

<button onclick="loadAnalytics()"
class="w-full mt-6 bg-emerald-600/20
border border-emerald-500/30
text-emerald-400 py-3 rounded-xl font-bold">
REFRESH CLICKHOUSE
</button>
</div>


<!-- AI -->
<div class="glass p-8 rounded-3xl shadow-2xl flex flex-col">

<h2 class="text-2xl font-bold mb-6 flex gap-2 text-blue-400">
<i data-lucide="sparkles"></i>
AI Insight
</h2>

<div id="ai-content"
class="flex-1 bg-black/40 p-5 rounded-xl
border border-white/5
min-h-[150px]
text-sm text-slate-300
italic leading-relaxed
whitespace-pre-line">

System ready for protocol analysis...
</div>

<button onclick="generateAISummary()"
id="ai-btn"
class="w-full mt-6 bg-blue-600 py-3
rounded-xl font-bold hover:bg-blue-500">
GENERATE AI SUMMARY
</button>

</div>
</div>


<!-- TODOS -->
<div class="glass p-8 rounded-3xl shadow-2xl">

<div class="flex flex-col md:flex-row
justify-between items-center mb-8 gap-6">

<h2 class="text-2xl font-bold flex gap-2">
<i data-lucide="list-checks"
class="text-blue-500"></i>
Task History
</h2>

<div class="flex w-full md:w-auto
bg-slate-900 rounded-2xl p-1.5">

<input id="todoInput"
placeholder="Initialize new task..."
class="bg-transparent px-4 py-2
outline-none w-full md:w-64">

<button onclick="addTodo()"
class="bg-blue-600 px-6 py-2 rounded-xl">
DEPLOY
</button>

</div>
</div>

<ul id="todoList"
class="space-y-3 max-h-[400px]
overflow-y-auto custom-scrollbar"></ul>

</div>

</div>

<script>

const API_BASE="http://127.0.0.1:8000";
lucide.createIcons();


// ================= ADD TODO =================
async function addTodo(){

const input=document.getElementById('todoInput');

if(!input.value) return;

await fetch(
`${API_BASE}/todos?task=${encodeURIComponent(input.value)}`,
{method:'POST'}
);

input.value='';
refresh();
}


// ================= FETCH TODOS =================
async function fetchTasks(){

const res=await fetch(`${API_BASE}/todos`);
const todos=await res.json();

document.getElementById('todoList').innerHTML=
todos.map(t=>`

<li class="flex justify-between p-4
bg-white/5 rounded-2xl">

<div class="flex gap-4">

<input type="checkbox"
${t.completed?'checked':''}
onchange="toggleTodo(${t.id},
'${t.task}',
${t.completed})">

<span class="${
t.completed
?'line-through text-slate-500'
:'text-slate-200'
}">
${t.task}
</span>

</div>

<button onclick="deleteTodo(${t.id})">
<i data-lucide="trash-2"></i>
</button>

</li>

`).join('');

lucide.createIcons();
}


// ================= AI SUMMARY FIXED =================
async function generateAISummary(){

const box=document.getElementById('ai-content');
const btn=document.getElementById('ai-btn');

box.innerText="Generating AI insight...";
btn.disabled=true;

try{

const res=await fetch(
`${API_BASE}/ai/productivity-summary`
);

const data=await res.json();

if(data.message){
box.innerText=data.message;
}else{
box.innerText=data.ai_summary;
}

}
catch(err){
box.innerText="AI service unavailable.";
}
finally{
btn.disabled=false;
}
}


// ================= ANALYTICS =================
async function loadAnalytics(){

const res=await fetch(
`${API_BASE}/analytics/summary`
);

const data=await res.json();

document.getElementById('total-created')
.innerText=data.total_created||0;

document.getElementById('completion-rate')
.innerText=(data.completion_rate||0)+"%";
}


// ================= UPDATE =================
async function toggleTodo(id,task,status){

await fetch(`${API_BASE}/todos/${id}`,{
method:'PUT',
headers:{'Content-Type':'application/json'},
body:JSON.stringify({
task:task,
completed:!status
})
});

refresh();
}


// ================= DELETE =================
async function deleteTodo(id){

await fetch(
`${API_BASE}/todos/${id}`,
{method:'DELETE'}
);

refresh();
}


// ================= REFRESH =================
function refresh(){
fetchTasks();
loadAnalytics();
}

refresh();

</script>

</body>
</html>